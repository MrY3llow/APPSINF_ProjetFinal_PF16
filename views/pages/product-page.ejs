<main class="container">

  <section class="card">
    <header class="card-head">
      <h1 class="card-title">Vente de <%= sell.owner %></h1>
      <hr>
    </header>


    <% if (sell.image) { %>
      <img src="/image/sell/<%= sell._id %>" alt="<%= sell.title %>" class="productPage-image">
    <% } %>
    <h2 class="card-title"><%= sell.title %></h2>
    <p class="card-subtitle">Description : <%= sell.description %></p>    

    <% if (sell.filter && typeof sell.filter === 'object') { %>
      <%
        let entries = Object.entries(sell.filter);
        entries = entries.filter(([key,value]) => value !== undefined && value !== null);

        if (sell.category === 'Véhicule') {
          for (let i=0; i<entries.length; i+=1) {
            if (entries[i][0] == 'Nombre de roue') {
              entries[i][1] += ' roues';
            } else if (entries[i][0] == 'KilomÃ©trage') {
              entries[i][1] += ' km';
            } else if (entries[i][0] == 'AnnÃ©e') {
              entries[i][1] = 'Années : ' + entries[i][1];
            }
          }
        }
      %>
      <p class="card-subtitle">
        Filtres : <%= sell.category %> , <%= entries.map(e => e[1]).join(', ') %>
      </p>
    <% } %>


    
    <p class="card-subtitle">Stock : <%= sell.quantity %></p>
    <p class="product-price"><%= sell.price %> €</p>    


    <!-- BUTTON >   Acheter -->
    <div class="actions">
      <%
      productNotAvailableText = "";
      if (sell.quantity <= 0) { productNotAvailableText += "Le produit n'est plus en stock.\n" }
      else if (!username) { productNotAvailableText += "Connectez vous pour acheter.\n" } 
      else if (username == sell.owner) { productNotAvailableText += "Vous ne pouvez pas acheter votre propre produit.\n" }%>

      <% if (productNotAvailableText) {%>
        <button class="btn" type="submit" disabled>Acheter le produit</button>
        <p class="product-not-available-text"><%- productNotAvailableText.replace(/\n/g, '<br>') %></p>
      <% } else { %>
        <form method="POST" action="/sell/<%= sell._id %>/buy">
          <button class="btn" type="submit">Acheter le produit</button>
        </form>
      <% } %>
    </div>

    <!-- Message d'erreur qui s'affiche s'il existe -->
    <% if (error) { %>
      <div class="error-message">
        <p><%- error.replace(/\n/g, '<br>') %></p>
      </div>
    <% } %>

  </section>
</main>