<main class="container">
  <section class="card">
    <header class="card-head">
      <h1 class="card-title">Créer une annonce</h1>
    </header>

    <form class="form" method="POST" enctype="multipart/form-data">

      <!-- INPUT >   Title -->
      <div class="field">
        <label for="title" class="label">Titre</label>
        <input id="title" type="text" name="title" class="input" placeholder="Titre de la vente" value="<%= titleInput %>">
      </div>

      <!-- INPUT >   Description -->
      <div class="field">
        <label for="description" class="label">Description</label>
        <textarea id="description" name="description" class="input input-area" placeholder="Description de la vente"><%= descriptionInput %></textarea>
      </div>

      <!-- INPUT > Image -->
      <div class="field">
        <label for="image" class="label">Image</label>
        <div class="image-upload-container">
          <label for="image" class="image-upload-btn">Choisir une image</label>
          <input id="image" type="file" name="image" class="image-input" accept="image/*">
          <img id="preview" class="preview-img" alt="Aperçu">
        </div>
        <small class="field-hint">Formats acceptés : JPG, PNG, WEBP. Taille max : 5 MB</small>
      </div>
            
      <!-- INPUT >   Adresse -->
      <div class="field">
        <label for="address" class="label">Address</label>
        <input id="address" type="text" name="address" class="input" placeholder="Adresse" value="<%= addressInput %>">
      </div>

      <!-- INPUT >   Prix -->
      <div class="field">
        <label for="price" class="label">Prix</label>
        <input id="price" type="number" name="price" class="input" placeholder="Prix" value="<%= priceInput %>" min="0.01" step="0.01">
      </div>

      <!-- INPUT >   Quantité -->
      <div class="field">
        <label for="quantity" class="label">Quantité</label>
        <input id="quantity" type="number" name="quantity" class="input" placeholder="Quantité" value="<%= quantityInput %>" min="1" step="1">
      </div>

      <!-- INPUT >   Etat -->
      <div class="field">
        <label for="state" class="label">État</label>
        <input id="state" type="text" name="adresse" class="input" placeholder="État" value="<%= stateInput %>">
      </div>

      <!-- Dropdown pour sélectionner une catégorie principale -->
      <div class="field">
        <label class="label" for="category-select">Catégories</label>
        <select id="category-select" class="input">
          <option value=""> ~ </option>
          <option value="Véhicule">Véhicule</option>
          <option value="Vêtements">Vêtements</option>
          <option value="Jouets">Jouets</option>
          <option value="Meubles">Meubles</option>
          <option value="Accessories">Accessoires</option>
        </select>
      </div>

      <div class="separator"></div>

      <!-- Sous-catégories multi-select qui s'affichent uniquement si "Véhicule" est sélectionné -->
      <div id="vehi-mileage-field" class="sub-dropdown" style="display: none;">
        <button type="button" class="dropdown-toggle">Kilométrage</button>
        <div class="dropdown-options">
          <label><input type="checkbox" value="0-5000">0 - 5 000 km</label>
          <label><input type="checkbox" value="5000-20000">5 000 - 20 000 km</label>
          <label><input type="checkbox" value="20000-50000">20 000 - 50 000 km</label>
          <label><input type="checkbox" value="50000+">50 000 km+</label>
        </div>
      </div>

      <div id="vehi-brand-field" class="sub-dropdown" style="display: none;">
        <button type="button" class="dropdown-toggle">Marque</button>
        <div class="dropdown-options">
          <label><input type="checkbox" value="volvo">Volvo</label>
          <label><input type="checkbox" value="toyota">Toyota</label>
          <label><input type="checkbox" value="ferrari">Ferrari</label>
          <label><input type="checkbox" value="volkswagen">Volkswagen</label>
        </div>
      </div>

      <div id="vehi-type-field" class="sub-dropdown" style="display: none;">
        <button type="button" class="dropdown-toggle">Type</button>
        <div class="dropdown-options">
          <label><input type="checkbox" value="voiture">Voiture</label>
          <label><input type="checkbox" value="moto">Moto</label>
          <label><input type="checkbox" value="vélo">Vélo</label>
          <label><input type="checkbox" value="quad">Quad</label>
        </div>
      </div>

      <div id="vehi-colour-field" class="sub-dropdown" style="display: none;">
        <button type="button" class="dropdown-toggle">Couleur</button>
        <div class="dropdown-options">
          <label><input type="checkbox" value="rouge">Rouge</label>
          <label><input type="checkbox" value="noir">Noir</label>
          <label><input type="checkbox" value="gris">Gris</label>
          <label><input type="checkbox" value="brun">Brun</label>
        </div>
      </div>

      <!-- BUTTON > Envoyer le formulaire -->
      <div class="actions">
        <button class="btn" type="submit">Publier votre annonce</button>
      </div>

      <!-- Message d'erreur -->
      <% if (error) { %>
        <div class="error-message">
          <p><%- error.replace(/\n/g, '<br>') %></p>
        </div>
      <% } %>

    </form>
  </section>

<script>
  document.getElementById('image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('preview');
    
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.classList.add('show');
      };
      reader.readAsDataURL(file);
    } else {
      preview.classList.remove('show');
    }
  });

  // Script pour la gestion des sous-dropdowns
  const categorySelect = document.getElementById('category-select');
  const subDropdownsVehicule = [
    document.getElementById('vehi-mileage-field'),
    document.getElementById('vehi-brand-field'),
    document.getElementById('vehi-type-field'),
    document.getElementById('vehi-colour-field')
  ];

  // montre les dropdowns des sous-catégories en fonction de la catégorie principale sélectionnée
  function toggleCat() {
    if (categorySelect.value === 'Véhicule') {
      subDropdownsVehicule.forEach(drop => drop.style.display = 'flex');
    } else {
      subDropdownsVehicule.forEach(drop => {
        drop.style.display = 'none';
        drop.querySelector('.dropdown-options').style.display = 'none';
      });
    }
  }

  toggleCat();
  categorySelect.addEventListener('change', toggleCat);

  // Gestion de l'affichage des options dans les sous-dropdowns
  subDropdownsVehicule.forEach(drop => {
    const btn = drop.querySelector('.dropdown-toggle');
    const options = drop.querySelector('.dropdown-options');

    btn.addEventListener('click', () => {
      options.style.display = options.style.display === 'flex' ? 'none' : 'flex';
    });

    // code pour empêcher la sélection de plusieurs options simultanément
    options.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', () => {
        if (cb.checked) {
          options.querySelectorAll('input[type="checkbox"]').forEach(other => {
            if (other !== cb) other.checked = false;
          });
        }
      });
    });
  });
</script>
</main>