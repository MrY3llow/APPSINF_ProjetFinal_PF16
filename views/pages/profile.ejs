<main class="container">
  <section class="card profile-card">

    <div class="profile-header">

      <div class="profile-header-info">
        <div class="profile-photo-wrapper">
        <img src="/image/user/<%= user.username %>" alt="Photo de profil" class="profile-photo">
        <div class="profile-shortcuts">
          <a href="historique_ventes.html" class="btn-outline">Mes ventes</a>
          <a href="historique_achat.html" class="btn-outline">Mes achats</a>
          <a href="ranking.html" class="btn-outline">Rank</a>
        </div>
        <h2 class="profile-username"><%= user.username %></h2>
      </div>
      
      <p class="profile-points">Points : <%= user.points %></p>
        <div class="profile-stars">★★★★★</div> <!-- [TODO] Afficher les étoiles selon user.rankingAverage (de 1 à 5) -->
        <div class="profile-balance"><%= user.balance %> €</div>
      <button class="btn-outline">Ajouter des fonds</button>
      
      <!-- INPUT > Image -->
      <div class="field">
        <label for="image" class="label">Modifier la photo de profile</label>
        <div class="image-upload-container">
          <label for="image" class="image-upload-btn">Choisir une image</label>
          <input id="image" type="file" name="image" class="image-input" accept="image/*">
        </div>
        <small class="field-hint">Formats acceptés : JPG, PNG, WEBP. Taille max : 5 MB</small>
      </div>
        
      </div>

    </div>

    <div class="profile-body">

      <div class="field">
        <label class="label">Modifier mot de passe</label>
        <input type="password" class="input" placeholder="Entrer un nouveau mot de passe">
      </div>

      <div class="profile-actions">

        <a class="brand" href="/mySells" aria-label="Accueil">
          <button class="btn-outline">Consulter ses ventes</button>
          </span>
        </a>

        <a class="brand" href="/purchase-history" aria-label="Accueil">
          <button class="btn-outline">Consulter ses achats</button>
          </span>
        </a>

        <a href="/logout">
          <button class="btn profile-logout">Déconnexion</button>
        </a>
      </div>

    </div>
  </section>

  <script>
    // Gestion de l'envoi de l'image au serveur
    document.getElementById('image').addEventListener('change', async function(e) {
      const file = e.target.files[0];
      
      if (file && file.type.startsWith('image/')) {
        // Envoyer l'image au serveur
        const formData = new FormData();
        formData.append('image', file);

        try {
          const response = await fetch('/profile/updateImage', {
            method: 'POST',
            body: formData
          });

          if (response.ok) {
            // Recharger la page pour afficher la nouvelle photo
            window.location.reload();
          } else {
            console.error('Erreur lors de l\'upload:', response.statusText);
            alert('Erreur lors de la mise à jour de la photo de profil');
          }
        } catch (error) {
          console.error('Erreur réseau:', error);
          alert('Erreur de connexion au serveur');
        }
      }
    });
  </script>

</main>