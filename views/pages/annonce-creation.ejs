<main class="container">
  <section class="card">
    <header class="card-head">
      <h1 class="card-title">Créer une annonce</h1>
    </header>

    <form class="form" method="POST" enctype="multipart/form-data">

      <!-- INPUT >   Title -->
      <div class="field">
        <label for="title" class="label">Titre</label>
        <input id="title" type="text" name="title" class="input" placeholder="Titre de la vente" value="<%= titleInput %>">
      </div>

      <!-- INPUT >   Description -->
      <div class="field">
        <label for="description" class="label">Description</label>
        <textarea id="description" name="description" class="input input-area" placeholder="Description de la vente"><%= descriptionInput %></textarea>
      </div>

      <!-- INPUT > Image -->
      <div class="field">
        <label for="image" class="label">Image</label>
        <div class="image-upload-container">
          <label for="image" class="image-upload-btn">Choisir une image</label>
          <input id="image" type="file" name="image" class="image-input" accept="image/*">
          <img id="preview" class="preview-img" alt="Aperçu">
        </div>
        <small class="field-hint">Formats acceptés : JPG, PNG, WEBP. Taille max : 5 MB</small>
      </div>
            
      <!-- INPUT >   Adresse -->
      <div class="field">
        <label for="address" class="label">Address</label>
        <input id="address" type="text" name="address" class="input" placeholder="Adresse" value="<%= addressInput %>">
      </div>

      <!-- INPUT >   Prix -->
      <div class="field">
        <label for="price" class="label">Prix</label>
        <input id="price" type="number" name="price" class="input" placeholder="Prix" value="<%= priceInput %>" min="0.01" step="0.01">
      </div>

      <!-- INPUT >   Quantité -->
      <div class="field">
        <label for="quantity" class="label">Quantité</label>
        <input id="quantity" type="number" name="quantity" class="input" placeholder="Quantité" value="<%= quantityInput %>" min="1" step="1">
      </div>

      <!-- INPUT >   Etat -->
      <div class="field">
        <label for="state" class="label">État</label>
        <input id="state" type="text" name="adresse" class="input" placeholder="État" value="<%= stateInput %>">
      </div>

      <!-- SELECT >   Catégorie -->
      <div class="field">
        <label for="category" class="label">Catégorie</label>
        <select id="category" name="category" class="input" required>
          <% if (!categoryInput) { %>
            <option value="" disabled selected>Sélectionnez une catégorie</option>
          <% } %>
          <% for(let category of categoryList) { %>
            <% if (category[0] == categoryInput) { %>
              <option value="<%= category[0] %>" selected><%= category[1] %></option>
            <% } else {  %>
              <option value="<%= category[0] %>"><%= category[1] %></option>
            <% } %>
              
          <% } %>
        </select>
      </div>
      
      <!-- BUTTON >   ENvoyer le formulaire -->
      <div class="actions">
        <button class="btn" type="submit">Publier votre annonce </button>
      </div>

      <!-- Message d'erreur qui s'affiche s'il existe -->
      <% if (error) { %>
        <div class="error-message">
          <p><%- error.replace(/\n/g, '<br>') %></p>
        </div>
      <% } %>

    </form>
  </section>

  <script>
    document.getElementById('image').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('preview');
      
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.classList.add('show');
        };
        reader.readAsDataURL(file);
      } else {
        preview.classList.remove('show');
      }
    });
  </script>

</main>